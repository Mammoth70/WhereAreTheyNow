## История WhereAreTheyNow?

Нумерация версий использует следующий формат:  

Major.Minor.Patch  

Major - крупные изменения и добавления, а также, изменения, которые делают приложения с разными Major версиями несовместимыми полностью или частично.  
Minor - небольшие изменения, влияющие на ход выполнения приложения или на интерфейс.  
Patch - совсем незначительные изменения.  

Обычно, нумерация версий идёт по порядку. До версии 3.11 использовался формат Major.Minor.

### 1.01 - 1.11
Ранние версии. (Не выкладывались на github).

### 2.01 - 2.14
Ранние версии. (Не выкладывались на github).

### 2.15
Первая версия, выложенная на github.  

В activity "Карточка контакта" слева от полей ввода добавлены иконки.  

В activity "Карточка контакта", и в activity "Настройки" у полей ввода телефона настроены шаблоны разрешённых символов.  

У полей ввода ограничен размер (20 символов для телефона, 25 символов для контакта).  

В activity "Карточка контакта" поля ввода теперь переходят в статус ошибки, если при сохранении они не заполнены.

### 2.16
Метод setfabStatus() переведён в private.  

В activity "Яндекс-карты" добавлен вывод toast с координатами при тапе на метке.  

В activity "Карточка контакта" поле выбора метки переходит в статус ошибки, если при сохранении метка не выбрана.  

При выборе поля статус ошибки теперь сбрасывается.

### 2.17
Контекстное меню в главной activity теперь создаётся не программно, а из ресурса menu.

### 2.18
В activity "Яндекс-карты" к toast с координатами при тапе на метке добавлено имя контакта.  

Все ресурсы меток получили цвета из ресурса colors, а обводку из ресурса themes.  

Для activity "Карточка контакта" сделаны ресурсы прозрачной (не выбранной метки) и метки в статусе ошибки.  

В activity "Карточка контакта" все тексты статусов ошибок стали информативными.  

В activity "Разрешения" сменены цвета. Запрещённые разрешения показаны цветом colorError.  

Подкорректирован зелёный цвет включённых разрешений.  

Удалены неиспользуемые ресурсы.  

Исправлена ошибка, из-за которой в activity "Яндекс-карты" при отключении показа круга отключались и надписи над метками.

### 2.19
В activity "Яндекс-карты" настройки стиля текста над меткой вынесены в отдельный метод, а настройки цвета текста над меткой и обводки теперь выбираются из ресурса themes, вместо ресурса colors.  

В activity "Настройки" добавлено поле настройки радиуса круга для Яндекс-карты.  

### 2.20
В ресурсе themes созданы атрибуты colorGranted и colorDenied для включённых и запрещённых разрешений, атрибутам назначены цвета.  

В activity "Разрешения" цвета включённых и запрещённых разрешений теперь выбираются из ресурса themes, вместо ресурса colors.  

В activity "Карточка контакта" цвета теперь выбираются из ресурса themes, вместо ресурса colors.  

### 2.21
В activity "Настройки" теперь показываются только те настройки, которые применимы к выбранной карте или имеют смысл.  

Список настроек меняется сразу при выборе карты.  

### 2.22
В about box подправлены цвета. Цвета в TextView для about box теперь берутся из ресурса styles.  

Все цвета (кроме меток) теперь определяются темами и стилями, и больше не берутся из ресурса colors.  

### 2.23
Из кода и ресурсов удалены неиспользуемые определения.

### 2.24
Добавлены ресурсы иконок ночной темы для кнопок FAB и ActionBar. Скорректированы цвета у аналогичных иконок дневной темы.

### 2.25
Удалены все png ресурсы иконок. Векторные ресурсы иконок сделаны универсальными для дневной и ночной тем.

### 2.26
Включена поддержка динамического цвета, поэтому приложение будет работать только на Android 12 и выше.  
Добавлена динамическая тема, сгенерированная из цвета обоев пользователя.  
Добавлены красная, жёлтая, зелёная и синяя темы.  

Переписаны класс SMSMonitor и метод sendSMS под Android 12 (API 31).

### 2.27
Произведена гармонизация цвета colorGranted для разных тем.  

Изменения в классах DBhelper, PointRecord, SMSmonitor, GetLocation.  

Добавлены drawable ресурсы ic_pin_error_48.xml и ic_pin_empty_48.xml. Изменения в методах getColorMarker и GetColoMarkerSmall.  
Методы теперь возвращают эти ресурсы в случае ошибки.  

Прочие незначительные изменения в коде.

### 3.00
Приложение переведено на Kotlin.  

Исходный код на Java перенесён в git-ветку java11.  

### 3.01
Внутренние изменения.

### 3.02
Избавились от хранения списка разрешенных телефонов одновременно в SharedPreferences и в БД SQLite.  
Список телефонов теперь хранится только в БД.

### 3.03
Запись с последними полученными координатами теперь хранится в БД SQLite вместо SharedPreferences.  

Добавлено удаление "висящих" записей из таблицы с координатами.

### 3.04
Изменения в drawable ресурсах. Удалены файлы с суффиксом "64", а файлы с суффиксом "48" переименованы. 

В activity "Карточка контакта", в activity выбора меток и в главной activity теперь используются те же ресурсы меток, что и в activity "Яндекс-карты". 

Удалены или переименованы дублирующиеся функции работы с ресурсами.

### 3.05
Настройки карт теперь передаются через переменные объекта Util, а не через intent.

### 3.06
Добавлена тема с базовыми цветами Google Material Design 3. 

Исправлена ошибка с недостающим цветом в жёлтой теме.

### 3.07
Применена тема Material Design 3 Expressive для всех кнопок FAB в activity "Яндекс-карты", теперь они стали более заметными.

### 3.08
На все activity добавлена кнопка "назад".  

На всех activity с картами изменена кнопка вызова меню.  

В activity "Яндекс-карты" при тапе на метку теперь выводятся не координаты тапа, как раньше, а координаты самой метки.  

Поправлены расстояния для кнопок FAB и IconButton, поправлены размеры и шрифты панелей.  

Внутренние изменения.

### 3.09
Все верхние панели сделаны объектами MaterialToolbar.

### 3.10
Все компоненты ListView и SimpleAdapter заменены на RecyclerView, а адаптеры на RecyclerView.Adapter соответственно.  

Для выбора меток использован класс GridLayoutManager.  

Поправлены макеты списков.

В список контактов добавлена кнопка выпадающего меню и кнопка определения собственной локации.

### 3.11
Сменена нумерация версий на формат Major.Minor.Patch. Сменена числовая нумерация версий на формат versionMajor * 10000 + versionMinor * 100 + versionPatch.  

Добавлены ещё две метки, теперь их двенадцать - можно красиво разложить по две, по три и по четыре в ряд.  

Произведён рефакторинг layout-ресурсов. Удалены лишние вложенности, удалены неиспользуемые параметры.  

Изменён дизайн всех списков.  

В activity "Яндекс-карты" изменена иконка кнопки FAB .  

Изменён цвет нижней панели с кнопкой.  

Внутренние изменения. Изменения в наследовании, исправления ошибок.

### 3.12
В activity выбора меток добавлена настройка количества колонок.  

Внутренние изменения. Исправления ошибок.

### 3.13.0
Смена версии Gradle на 9.3.0.  

Переход на AGP 9.0.0.  

Переход на встроенный Kotlin.  

Объявления зависимостей перенесены в файл libs.versions.toml.  

В файле gradle.properties удалены deprecated настройки.  

Выполнено уменьшение размера apk. Для этого в файле app/build.gradle.kts включены соответствующие настройки. Добавлен файл res/raw/keep.xml.  

Отказ от конструкции "object: PopupMenu.OnMenuItemClickListener" при создании меню.  

Отказ от использования в файлах макетов атрибута "android:onClick". Вместо этого сделаны программные установки всех листенеров через setOnClickListener.  

Привязки листенеров в адаптерах перенесены из API функций в конструкторы.  
Установки листенеров в адаптерах перенесены из onBindViewHolder в Init.  

Изменение года разработки приложения в файлах ресурсов strings.xml.  

Внутренние изменения.

### 3.13.1
Произведено переименование макетов.  
Для файлов переиспользуемых макетов (include) применяется префикс partial_. Для макета диалога - префикс dialog_.  

### 3.13.2
Изменения в файлах ресурсов.  
Из файлов с ресурсами меню удалены группы.

### 3.14.0
Большие изменения в архитектуре проекта.  

Добавлен класс данных User для хранения всех полей контакта.  
Добавлен объект DataRepository - основной список объектов. В результате, избавились от большого количества несвязанных HashMap.  

Класс DBhelper переписан для работы с DataRepository. Вызовы DBhelper мимо DataRepository больше не применяются.  
Оптимизированы SQL-вызовы. Исправлена ошибка в SQL-вызове функции readDbLastAnswer.  

Классы UsersAdapter и GeoAdapter переписаны для работы с объектом DataRepository.  
В классе UsersAdapter теперь используется ListAdapter c использованием DiffUtil.  

Добавлен объект SettingsManager. В него перенесено всё управление переменными настроек, и чтение/запись настроек из SharedPreferences. Некоторые настройки кешируются в памяти.  

Произведены изменения в классах GetLocation и GetLocationService. GetLocationService переведён в Foreground-режим, добавлен NotificationChannel. Добавлен обратный вызов для остановки сервиса.  
В класе GetLocation используется fusedLocationClient.getCurrentLocation.  

Сделан более "умным" возврат в MainActivity из SettingsActivity.  

В функции timePassed исправлена ошибка подсчёта разности дат .

### 3.14.1
В файлах исходного кода и ресурсов разделители \r\n заменены на \n.

### 3.14.2
Поправлена SettingsActivity. Добавлены комментарии.  

Добавлены разрешения на отправку уведомлений для работы NotificationChannel в классе GetLocationService.  
Внесены соответствующие изменения в макет и код PermissionActivity и в код MainActivity.  
Добавлены или изменены соответствующие строковые ресурсы.

### 3.14.3
Исправлена ошибка, из-за которой при запуске приложения не устанавливались темы.

### 3.14.4
Исправлена ошибка в PermissionActivity, из-за которой приложение падало при установке разрешений на отправку уведомлений.  

Переписан класс UsersAdapter. Из кода удалены внутренние классы футера, а в макет добавлены атрибуты "android:paddingBottom" и "android:clipToPadding", создающие и настраивающие внутренний отступ.

### 3.14.5
Небольшая оптимизация PermissionActivity.  
Перерисовка текста вынесена в функции setViewsGranted и setViewsDenied.  
Отображение кнопок вынесено в функции setButtonEnable и setButtonDisable.

### 3.14.6
Изменения в PermissionActivity.  
Отказ от requestPermissions и обработки в onRequestPermissionsResult. Переход на ActivityResultLauncher.  
Инициализация запроса разрешения "Работа в фоновом режиме" теперь происходит строго после одобрения разрешения "Точное местоположение".  
Получение цветов темы вынесено в функцию getThemeColor.  
Сделана функция showErrorSnackbar, для вывода сообщений в Snackbar.

### 3.14.7
Изменения в макете. В файле activity_main.xml избавились от ConstraintLayout. Поправлен макет partial_fab_main.xml, чтобы кнопка FAB могла взаимодействовать с CoordinatorLayout.

### 3.14.8
В классе DBHelper изменены параметры функций.  
Соответственно, изменены параметры функций в объекте DataRepository.  
Добавлены дополнительные проверки в функциях объекта DataRepository.  

Написаны функции логирования для приложения, собранного в отладочном режиме.  
Во все пустые блоки catch добавлено логирование ошибок.  

В объект AppColors добавлена функция isValidColors, проверяющая строку на вхождение в список строк с цветом.  

Класс SMSMonitor переименован в SMSmonitor.

### 3.14.9
Объект AppColors переименован в PinColors. Переименованы некоторые функции объекта.  
Список colors переделан в класс перечислений Color. Соответствующим образом переделаны функции объекта PinColors и все внешние вызовы.  

Небольшие изменения проверок в функции readDbAllUsers класса DBHelper.

### 3.14.10
Ещё небольшие изменения проверок в функции readDbAllUsers класса DBHelper.

### 3.14.11
В функции класса DataRepository добавлены конструкции "synchronized". 

### 3.15.0
Добавлены модульные и инструментальные тесты:
- модульный тест функции timePassed;
- инструментальный тест работоспособности тестового окружения на устройстве.  

Для удобства тестирования функция timePassed разделена собственно на timePassed (вывод текста в контекст) и calculateTimePassed (логика).  

По результатам тестирования исправлены ошибки в логике calculateTimePassed.

### 3.15.1
Изменения в объекте SettingsManager.  
Все настройки кешируются в памяти в private переменных с аннотациями @Volatile.  
Переписаны геттеры и сеттеры публичных переменных с настройками.  
Чтение настроек из SharedPreferences теперь осуществляется только при инициализации переменных.  

Изменения в макете и коде SettingsActivity.  
Все чекбоксы заменены на переключатели. Поправлены некоторые листенеры.

### 3.15.2
Незначительные изменения объявлений листенеров в SettingsActivity, UserActivity и YandexActivity.

### 3.15.3
Изменения в объекте SettingsManager.  
Теперь переменные с настройками записываются в SharedPreferences только при изменении текущего значения, а не при любом вызове сеттера.

### 3.15.4
Изменения в объекте DataRepository.  
Теперь после изменения или удаления контакта происходит чтение из БД списка меню и последней записи координат.  

Изменения в классе GeoAdapter.  
Константы типов элемента сделаны приватными.

### 3.15.5
Удалён более не используемый файл макета футера item_user_footer.xml.

### 3.15.6
Смена версии Gradle на 9.3.1.  
Обновлены объявления зависимостей в файле libs.versions.toml.

### 3.16.0
Переход на AGP 9.0.1.  

В файле gradle.properties сделана настройка android.nonTransitiveRClass=true.  
Функция getThemeColor перенесена в модуль Util.  
Создан файл ресурса value/attrs.xml, и в него перенесены или добавлены атрибуты вызываемых из кода цветов темы.  
Поправлены вызовы R.attr.  

У функций, вызывающих ресурсы по ID, указаны аннотации @AttrRes, @StringRes и @DrawableRes.  
У переменной idLayout в абстрактном классе AppActivity указана аннотация @LayoutRes.  
У переменной idActivity в абстрактном классе AppActivity указана аннотация @IdRes.  

Добавлены модульные тесты:
- модульный тест функции parseSMS;
- интеграционный тест связки функций formatLocation и parseSMS.  

Изменения в классе SMSmonitor.  
Для удобства тестирования код разбора SMS вынесен из функции receiveLocation в функцию parseSMS.  
По результатам тестирования внесены исправления в parseSMS.  
Приватные константы перенесены из модуля Util в SMSmonitor.  

Изменения в классе GetLocation.  
Для удобства тестирования произведена декомпозиция функции formatLocation на две с разными параметрами вызова.  
Приватные константы перенесены из модуля Util в GetLocation.  

Незначительные правки в макетах.  
Небольшие изменения в привязке выпадающих меню.

### 3.16.1
Изменения в интерфейсе:
- диалоговое окно AboutDialog переделано в стиле Material3;
- поправлен файл макета окна AboutDialog;
- поправлен файл styles.xml;
- изменения в строковых ресурсах.

### 3.16.2
В код добавлены комментарии.

### 3.16.3
Класс AboutBox переименован в AboutDialog.  
При вызове диалогового окна больше не применяется передача аргументов через Bundle.

### 3.16.4
Изменения в классе SMSmonitor.  
Теперь паттерны regexp компилируются сразу при объявлении.